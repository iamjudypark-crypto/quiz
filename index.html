import React, { useState } from 'react';
import { ChevronRight, Heart, Shield, Zap, Users } from 'lucide-react';

const AttachmentStyleQuiz = () => {
  const [currentScreen, setCurrentScreen] = useState('welcome');
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [answers, setAnswers] = useState([]);
  const [result, setResult] = useState(null);
  const [isAnimating, setIsAnimating] = useState(false);

  const questions = [
    {
      text: "소중한 사람이 거리를 두면, 나는...",
      options: [
        { text: "언제든 연락할 수 있게 하면서 공간을 준다", score: { secure: 3, anxious: 0, avoidant: 1, fearful: 1 } },
        { text: "그 사람이 나에게 흥미를 잃는 건 아닐까 걱정한다", score: { secure: 0, anxious: 3, avoidant: 0, fearful: 2 } },
        { text: "내 삶의 다른 일에 집중한다", score: { secure: 1, anxious: 0, avoidant: 3, fearful: 1 } },
        { text: "혼란스러워서 나도 거리를 둔다", score: { secure: 0, anxious: 1, avoidant: 1, fearful: 3 } }
      ]
    },
    {
      text: "관계에서 나는 이것이 가장 쉽다...",
      options: [
        { text: "솔직하고 개방적으로 내 감정을 나눈다", score: { secure: 3, anxious: 1, avoidant: 0, fearful: 0 } },
        { text: "취약해 보여도 내 필요를 표현한다", score: { secure: 2, anxious: 3, avoidant: 0, fearful: 1 } },
        { text: "나의 일부를 비공개로 유지한다", score: { secure: 0, anxious: 0, avoidant: 3, fearful: 2 } },
        { text: "친밀함과 독립 사이에서 갈등한다", score: { secure: 0, anxious: 1, avoidant: 1, fearful: 3 } }
      ]
    },
    {
      text: "다른 사람에게 의지하는 것에 대해, 나는...",
      options: [
        { text: "필요할 때 도움을 요청하는 게 편하다", score: { secure: 3, anxious: 1, avoidant: 0, fearful: 0 } },
        { text: "가까운 사람들에게 자주 확신을 구한다", score: { secure: 0, anxious: 3, avoidant: 0, fearful: 1 } },
        { text: "혼자 해결하는 걸 선호한다", score: { secure: 0, anxious: 0, avoidant: 3, fearful: 1 } },
        { text: "지지를 원하지만 부담될까 두렵다", score: { secure: 1, anxious: 1, avoidant: 1, fearful: 3 } }
      ]
    },
    {
      text: "나의 이상적인 관계 방식은...",
      options: [
        { text: "함께 있음과 독립 사이의 균형", score: { secure: 3, anxious: 0, avoidant: 1, fearful: 0 } },
        { text: "많은 시간과 정서적 친밀감", score: { secure: 1, anxious: 3, avoidant: 0, fearful: 1 } },
        { text: "나의 자율성과 개인 공간 유지", score: { secure: 1, anxious: 0, avoidant: 3, fearful: 1 } },
        { text: "내 복잡함을 이해하는 사람 찾기", score: { secure: 0, anxious: 1, avoidant: 0, fearful: 3 } }
      ]
    },
    {
      text: "관계에서 갈등이 생기면, 나는 보통...",
      options: [
        { text: "침착하게 해결책을 찾는다", score: { secure: 3, anxious: 0, avoidant: 0, fearful: 0 } },
        { text: "이야기할 때까지 불안하다", score: { secure: 0, anxious: 3, avoidant: 0, fearful: 1 } },
        { text: "이야기하기 전에 혼자 있을 시간이 필요하다", score: { secure: 1, anxious: 0, avoidant: 3, fearful: 1 } },
        { text: "압도되고 어떻게 반응해야 할지 모르겠다", score: { secure: 0, anxious: 1, avoidant: 0, fearful: 3 } }
      ]
    },
    {
      text: "관계에서 신뢰는...",
      options: [
        { text: "누군가를 알아가면서 자연스럽게 생긴다", score: { secure: 3, anxious: 0, avoidant: 1, fearful: 0 } },
        { text: "지속적인 확신과 검증이 필요하다", score: { secure: 0, anxious: 3, avoidant: 0, fearful: 1 } },
        { text: "천천히 생기고, 건강한 회의를 유지한다", score: { secure: 1, anxious: 0, avoidant: 3, fearful: 1 } },
        { text: "파도처럼 - 때로는 쉽게, 때로는 전혀 아니다", score: { secure: 0, anxious: 1, avoidant: 0, fearful: 3 } }
      ]
    }
  ];

  const attachmentStyles = {
    secure: {
      title: "안정 애착형",
      icon: <Heart className="w-12 h-12" />,
      color: "from-rose-400 to-pink-600",
      description: "당신은 관계에 대해 건강하고 균형 잡힌 접근 방식을 가지고 있습니다. 친밀감과 독립성 모두 편안하고, 필요를 효과적으로 전달하며, 신뢰가 자연스럽게 형성됩니다.",
      traits: ["정서적으로 안정적", "경계 설정 능력", "친밀감에 편안함", "효과적인 의사소통"],
      growth: "안정적인 기반 덕분에 깊고 의미 있는 관계를 형성할 수 있습니다. 개방적인 소통과 공감으로 관계를 계속 발전시켜 나가세요."
    },
    anxious: {
      title: "불안 애착형",
      icon: <Zap className="w-12 h-12" />,
      color: "from-amber-400 to-orange-600",
      description: "친밀한 관계를 매우 소중히 여기며, 때로는 상대방의 감정에 대해 걱정할 수 있습니다. 큰 마음과 깊은 정서적 연결 능력을 가지고 있습니다.",
      traits: ["높은 공감 능력", "정서적 친밀감 중시", "타인 감정에 직관적", "열정적이고 배려심 많음"],
      growth: "자기 진정 기술을 연습하고 관계와 독립적인 자존감을 키우세요. 당신의 민감성은 자신감과 균형을 이룰 때 강점이 됩니다."
    },
    avoidant: {
      title: "회피 애착형",
      icon: <Shield className="w-12 h-12" />,
      color: "from-emerald-400 to-teal-600",
      description: "독립성과 자립을 중요하게 생각합니다. 관계를 형성할 수 있지만, 어느 정도 정서적 거리와 개인 공간을 유지하는 것을 선호합니다.",
      traits: ["자립적", "독립적 사고", "강한 경계", "개인 성장 중시"],
      growth: "신뢰하는 사람들과 취약한 순간을 나누는 것에 도전해 보세요. 독립성은 가치 있으며, 정서적 개방성과 결합하면 더 깊은 관계를 형성할 수 있습니다."
    },
    fearful: {
      title: "두려움-회피 애착형",
      icon: <Users className="w-12 h-12" />,
      color: "from-purple-400 to-indigo-600",
      description: "친밀한 관계를 원하면서도 동시에 취약성을 두려워하는 복잡한 감정을 경험합니다. 이는 인간 복잡성에 대한 독특한 깊이와 이해를 만듭니다.",
      traits: ["깊은 성찰 능력", "높은 통찰력", "복잡한 감정 범위", "회복력"],
      growth: "자기 연민을 실천하고 안전한 사람들과 점진적으로 취약함을 드러내세요. 다양한 관점을 보는 능력은 깊은 연결로 이어질 수 있는 선물입니다."
    }
  };

  const calculateResult = () => {
    const scores = { secure: 0, anxious: 0, avoidant: 0, fearful: 0 };
    
    answers.forEach(answer => {
      Object.keys(scores).forEach(style => {
        scores[style] += answer.score[style];
      });
    });

    const maxScore = Math.max(...Object.values(scores));
    const result = Object.keys(scores).find(key => scores[key] === maxScore);
    
    return result;
  };

  const handleAnswer = (option) => {
    setIsAnimating(true);
    const newAnswers = [...answers, option];
    setAnswers(newAnswers);

    setTimeout(() => {
      if (currentQuestion < questions.length - 1) {
        setCurrentQuestion(currentQuestion + 1);
      } else {
        const style = calculateResult();
        setResult(style);
        setCurrentScreen('result');
      }
      setIsAnimating(false);
    }, 300);
  };

  const restart = () => {
    setIsAnimating(true);
    setTimeout(() => {
      setCurrentScreen('welcome');
      setCurrentQuestion(0);
      setAnswers([]);
      setResult(null);
      setIsAnimating(false);
    }, 300);
  };

  const startQuiz = () => {
    setIsAnimating(true);
    setTimeout(() => {
      setCurrentScreen('quiz');
      setIsAnimating(false);
    }, 300);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 flex items-center justify-center p-4">
      <div className="max-w-2xl w-full">
        <div className={`transition-all duration-500 transform ${isAnimating ? 'scale-95 opacity-0' : 'scale-100 opacity-100'}`}>
          {currentScreen === 'welcome' && (
            <div className="text-center space-y-8">
              <div className="relative">
                <div className="absolute inset-0 blur-3xl bg-gradient-to-r from-pink-500 to-violet-600 opacity-30 rounded-full"></div>
                <h1 className="relative text-6xl font-bold text-white mb-4 tracking-tight">
                  <span className="block text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-violet-400">
                    애착유형 테스트
                  </span>
                </h1>
              </div>
              
              <p className="text-xl text-gray-200 max-w-md mx-auto leading-relaxed">
                다른 사람과 어떻게 연결되는지 이해하면 관계를 변화시키고 자기 인식을 깊게 할 수 있습니다
              </p>
              
              <button
                onClick={startQuiz}
                className="group relative inline-flex items-center gap-3 bg-white/10 backdrop-blur-md text-white px-8 py-4 rounded-full font-semibold text-lg transition-all duration-300 hover:bg-white/20 hover:scale-105 hover:shadow-2xl shadow-lg"
              >
                <span>시작하기</span>
                <ChevronRight className="w-5 h-5 transition-transform group-hover:translate-x-1" />
                <div className="absolute inset-0 rounded-full bg-gradient-to-r from-pink-500 to-violet-600 opacity-0 group-hover:opacity-20 transition-opacity blur-xl"></div>
              </button>
            </div>
          )}

          {currentScreen === 'quiz' && (
            <div className="space-y-8">
              <div className="flex justify-between items-center mb-8">
                <div className="flex gap-2">
                  {questions.map((_, index) => (
                    <div
                      key={index}
                      className={`h-2 rounded-full transition-all duration-500 ${
                        index < currentQuestion
                          ? 'w-12 bg-gradient-to-r from-pink-400 to-violet-400'
                          : index === currentQuestion
                          ? 'w-16 bg-white/50'
                          : 'w-8 bg-white/20'
                      }`}
                    />
                  ))}
                </div>
                <span className="text-white/60 text-sm font-medium">
                  {currentQuestion + 1} / {questions.length}
                </span>
              </div>

              <div className="bg-white/10 backdrop-blur-md rounded-3xl p-8 shadow-2xl">
                <h2 className="text-2xl font-bold text-white mb-8 leading-relaxed">
                  {questions[currentQuestion].text}
                </h2>
                
                <div className="space-y-3">
                  {questions[currentQuestion].options.map((option, index) => (
                    <button
                      key={index}
                      onClick={() => handleAnswer(option)}
                      className="w-full text-left p-6 rounded-2xl bg-white/5 backdrop-blur-sm border border-white/10 text-white transition-all duration-300 hover:bg-white/10 hover:border-white/30 hover:scale-[1.02] hover:shadow-lg"
                    >
                      <span className="text-lg leading-relaxed">{option.text}</span>
                    </button>
                  ))}
                </div>
              </div>
            </div>
          )}

          {currentScreen === 'result' && result && (
            <div className="space-y-8">
              <div className="text-center">
                <div className={`inline-flex p-6 rounded-full bg-gradient-to-br ${attachmentStyles[result].color} text-white mb-6 shadow-2xl`}>
                  {attachmentStyles[result].icon}
                </div>
                
                <h2 className="text-5xl font-bold text-white mb-4">
                  {attachmentStyles[result].title}
                </h2>
                
                <p className="text-xl text-gray-200 max-w-lg mx-auto leading-relaxed mb-8">
                  {attachmentStyles[result].description}
                </p>
              </div>

              <div className="bg-white/10 backdrop-blur-md rounded-3xl p-8 shadow-2xl space-y-6">
                <div>
                  <h3 className="text-2xl font-semibold text-white mb-4">당신의 강점</h3>
                  <div className="grid grid-cols-2 gap-3">
                    {attachmentStyles[result].traits.map((trait, index) => (
                      <div
                        key={index}
                        className="bg-white/10 backdrop-blur-sm rounded-xl p-4 text-white/90 text-center"
                      >
                        {trait}
                      </div>
                    ))}
                  </div>
                </div>

                <div>
                  <h3 className="text-2xl font-semibold text-white mb-4">성장 방향</h3>
                  <p className="text-gray-200 leading-relaxed">
                    {attachmentStyles[result].growth}
                  </p>
                </div>
              </div>

              <div className="text-center">
                <button
                  onClick={restart}
                  className="group relative inline-flex items-center gap-3 bg-white/10 backdrop-blur-md text-white px-8 py-4 rounded-full font-semibold text-lg transition-all duration-300 hover:bg-white/20 hover:scale-105 hover:shadow-2xl shadow-lg"
                >
                  <span>다시 테스트하기</span>
                  <ChevronRight className="w-5 h-5 transition-transform group-hover:translate-x-1" />
                  <div className="absolute inset-0 rounded-full bg-gradient-to-r from-pink-500 to-violet-600 opacity-0 group-hover:opacity-20 transition-opacity blur-xl"></div>
                </button>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default AttachmentStyleQuiz;
